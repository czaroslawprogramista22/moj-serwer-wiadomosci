<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Panel Monitoringu FP</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <h1>Wiadomo≈õci üöÄ</h1>
        <form id="form-wiadomosc">
            <input type="text" name="wiadomosc" placeholder="Tre≈õƒá..." required style="width: 70%;">
            <button type="submit">Dodaj</button>
        </form>
        <ul id="lista-wiadomosci" style="list-style: none; padding: 0;"></ul>
    </div>

    <div class="container">
        <h2>Ostatnie Logi Fingerprint√≥w üïµÔ∏è‚Äç‚ôÇÔ∏è</h2>
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Nick</th>
                    <th>ID Konta</th>
                    <th>Fingerprint</th>
                </tr>
            </thead>
            <tbody id="tabela-logow"></tbody>
        </table>
    </div>

    <a href="/logout" class="btn-logout">Wyloguj administratora</a>

    <script>
        const listaWiadomosci = document.getElementById('lista-wiadomosci');
        const tabelaLogow = document.getElementById('tabela-logow');

        function odswiezWiadomosci() {
            fetch('/api/lista').then(res => res.json()).then(data => {
                listaWiadomosci.innerHTML = "";
                data.forEach(w => {
                    const li = document.createElement('li');
                    li.className = 'msg-item';
                    li.innerHTML = `<span>${w.tresc}</span> <button onclick="usunWiadomosc(${w.id})" style="background:#ff4444;">X</button>`;
                    listaWiadomosci.appendChild(li);
                });
            });
        }

        function odswiezLogi() {
            fetch('/api/logs').then(res => res.json()).then(data => {
                tabelaLogow.innerHTML = "";
                data.forEach(log => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${log.data}</td>
                        <td><b>${log.nick}</b></td>
                        <td>${log.account_id}</td>
                        <td class="fp-text">${log.fp}</td>
                    `;
                    tabelaLogow.appendChild(tr);
                });
            });
        }

        async function usunWiadomosc(id) {
            await fetch('/api/usun', { method: 'POST', headers: {'Content-Type': 'application/x-www-form-urlencoded'}, body: `id=${id}` });
            odswiezWiadomosci();
        }

        document.getElementById('form-wiadomosc').onsubmit = async (e) => {
            e.preventDefault();
            await fetch('/api/wiadomosc', { method: 'POST', body: new URLSearchParams(new FormData(e.target)) });
            e.target.reset();
            odswiezWiadomosci();
        };

        odswiezWiadomosci();
        odswiezLogi();
        setInterval(odswiezLogi, 5000);
    </script>
</body>
</html>